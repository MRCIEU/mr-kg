# Case study configuration for MR-KG reproducibility analyses
#
# This configuration file contains shared parameters used across case study
# 1 (reproducibility analysis) and case study 5 (temporal trends).
# Modify thresholds and paths here rather than in individual scripts.

# ==== Global settings ====
random_seed: 42
log_level: "INFO"

# ==== Database paths ====
databases:
  evidence_profile: "data/db/evidence_profile_db.db"
  trait_profile: "data/db/trait_profile_db.db"
  vector_store: "data/db/vector_store.db"

# ==== Output directories ====
output:
  case_study_1:
    base: "data/processed/case-study-cs1"
    raw_pairs: "data/processed/case-study-cs1/raw_pairs"
    metrics: "data/processed/case-study-cs1/metrics"
    models: "data/processed/case-study-cs1/models"
    figures: "data/processed/case-study-cs1/figures"
  case_study_5:
    base: "data/processed/case-study-cs5"
    temporal: "data/processed/case-study-cs5/temporal"
    diversity: "data/processed/case-study-cs5/diversity"
    consistency: "data/processed/case-study-cs5/consistency"
    completeness: "data/processed/case-study-cs5/completeness"
    fashionable: "data/processed/case-study-cs5/fashionable"
    pleiotropy: "data/processed/case-study-cs5/pleiotropy"
    winners_curse: "data/processed/case-study-cs5/winners_curse"
    figures: "data/processed/case-study-cs5/figures"

# ==== Validation notes directories ====
notes:
  case_study_1: ".notes/analysis-notes/case-study-analysis/cs1-validation"
  case_study_5: ".notes/analysis-notes/case-study-analysis/cs5-temporal"

# ==== Case Study 1: Reproducibility thresholds ====
case_study_1:
  # Minimum number of studies required for a trait pair to be included
  min_study_count: 2

  # Reproducibility tier cutoffs (direction concordance scale: -1 to 1)
  reproducibility_tiers:
    high: 0.7          # >= 0.7: High reproducibility
    moderate: 0.3      # >= 0.3: Moderate reproducibility
    low: 0.0           # >= 0.0: Low reproducibility
    # < 0.0: Discordant

  # Study count stratification buckets
  study_count_bands:
    - [2, 3]           # Small sample (2-3 studies)
    - [4, 6]           # Medium sample (4-6 studies)
    - [7, 10]          # Large sample (7-10 studies)
    - [11, 999]        # Very large sample (11+ studies)

  # Temporal era definitions (aligned with methodological milestones)
  temporal_eras:
    early_mr: [2003, 2014]       # Foundation era (expanded to cover full sample)
    mr_egger: [2015, 2017]       # MR-Egger for pleiotropy
    mr_presso: [2018, 2019]      # MR-PRESSO for outlier detection
    within_family: [2020, 2020]  # Within-family designs
    strobe_mr: [2021, 2025]      # STROBE-MR reporting guidelines (expanded to cover full sample)

  # Validation examples selection
  validation:
    n_top_concordant: 20
    n_top_discordant: 20
    canonical_pairs:
      # Known trait pairs with strong MR evidence
      - ["LDL cholesterol", "coronary artery disease"]
      - ["body mass index", "type 2 diabetes"]
      - ["smoking", "lung cancer"]
      - ["alcohol consumption", "cardiovascular disease"]
      - ["systolic blood pressure", "stroke"]

  # Similarity expansion configuration
  similarity_expansion:
    enabled: true
    similarity_threshold: 0.9
    adaptive_thresholds: true
    min_similarity_for_match: 0.9
    cache_size_limit: 10000
    batch_size: 100

  # Category analysis (outcome-only stratification)
  category_analysis:
    enabled: true
    categorization_method: "outcome_only"
    category_mapping:
      cardiovascular:
        - "cardiovascular"
        - "heart disease"
        - "coronary artery disease"
        - "coronary heart disease"
        - "myocardial infarction"
        - "stroke"
        - "ischemic stroke"
        - "atrial fibrillation"
        - "heart failure"
      metabolic:
        - "metabolic"
        - "diabetes"
        - "type 2 diabetes"
        - "obesity"
        - "body mass index"
        - "waist circumference"
        - "insulin"
        - "glucose"
        - "cholesterol"
        - "triglycerides"
      psychiatric:
        - "psychiatric"
        - "mental health"
        - "depression"
        - "anxiety"
        - "schizophrenia"
        - "bipolar"
      cancer:
        - "cancer"
        - "oncology"
        - "carcinoma"
        - "tumor"
        - "malignancy"
      autoimmune:
        - "autoimmune"
        - "rheumatoid arthritis"
        - "lupus"
        - "inflammatory"
      other:
        - "other"
        - "mixed"
    min_pairs_per_category: 10
    min_coverage_threshold: 0.40

# ==== Match type stratification ====
match_types:
  exact: "exact"
  fuzzy: "fuzzy"
  efo: "efo"

# ==== Statistical modeling parameters ====
modeling:
  # Temporal trend analysis
  temporal:
    model_type: "linear"          # linear, logistic, mixed_effects
    predictors:
      - "publication_year"
      - "study_count"
      - "match_type_exact"
    min_observations: 30
    confidence_level: 0.95

  # Diagnostics thresholds
  diagnostics:
    max_vif: 10                   # Variance inflation factor
    min_observations_per_group: 5

# ==== Figure settings ====
figures:
  dpi: 300
  format: ["png", "svg"]
  style: "seaborn-v0_8-whitegrid"
  figsize:
    single: [8, 6]
    double: [12, 6]
    large: [14, 10]

# ==== Case Study 5: Temporal evolution of MR evidence ====
case_study_5:
  # Model filtering (CRITICAL)
  models_included:
    - "gpt-5"
  models_excluded: []

  # Temporal era definitions
  temporal_eras:
    early_mr: [2003, 2014]       # Foundation era (expanded to cover full sample)
    mr_egger: [2015, 2017]       # MR-Egger for pleiotropy
    mr_presso: [2018, 2019]      # MR-PRESSO for outlier detection
    within_family: [2020, 2020]  # Within-family designs
    strobe_mr: [2021, 2025]      # STROBE-MR reporting guidelines (expanded to cover full sample)

  # COVID era flag
  covid_era_years: [2020, 2021]

  # Trait diversity thresholds
  trait_diversity:
    min_studies_per_year: 10
    min_traits_per_study: 1

  # Evidence consistency thresholds
  evidence_consistency:
    min_pairs_per_era: 10
    concordance_improvement_threshold: 0.05

  # Reporting completeness fields
  reporting_completeness:
    required_fields:
      - "beta"
      - "odds_ratio"
      - "hazard_ratio"
      - "ci_lower"
      - "ci_upper"
      - "ci_95"
      - "p_value"
      - "direction"
      - "f_statistic"
    composite_completeness_definition:
      - "any_effect_size"
      - "ci"
      - "p_value"
    strobe_breakpoint: 2021

  # Fashionable traits
  fashionable_traits:
    top_k_per_year: 10
    hype_cycle_growth_threshold: 1.0
    hype_cycle_decline_threshold: 0.5
    min_occurrences_for_trend: 3

  # Pleiotropy awareness
  pleiotropy:
    canonical_pairs:
      - ["body mass index", "waist circumference"]
      - ["body mass index", "educational attainment"]
      - ["alcohol intake", "HDL cholesterol"]
      - ["smoking", "educational attainment"]
      - ["systolic blood pressure", "body mass index"]
    mr_presso_breakpoint: 2018

  # Winner's curse
  winners_curse:
    min_studies_per_pair: 5
    min_effect_size_availability: 0.1
    subgroup_categories:
      - "trait_category"
      - "study_type"
      - "journal_tier"
      - "era"
    effect_size_fields:
      - "beta"
      - "odds_ratio"
      - "hazard_ratio"
    expected_decline_range: [0.15, 0.25]

  # Statistical settings
  statistical:
    confidence_level: 0.95
    significance_threshold: 0.05
    min_observations_for_regression: 10

# ==== Analysis subsampling (for development/testing) ====
subsampling:
  enabled: false
  max_combinations: 1000
  max_pairs_per_combination: 100
