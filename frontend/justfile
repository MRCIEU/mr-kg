# Frontend Development Tasks

# Default recipe
default:
    @just --list --unsorted

# ==== Development ====

# Start development server with hot reload
[group('development')]
dev:
    npm run dev

# Install dependencies
[group('development')]
install:
    npm install

# ==== Build ====

# Build for production
[group('build')]
build:
    npm run build

# Preview production build
[group('build')]
preview:
    npm run preview

# ==== Code Quality ====

# Format code with prettier
[group('quality')]
format:
    npm run format

# Lint code with eslint
[group('quality')]
lint:
    npm run lint

# Type check with vue-tsc
[group('quality')]
type-check:
    npm run type-check

# Run all quality checks
[group('quality')]
check: lint type-check

# ==== Testing ====

# Run unit tests
[group('testing')]
test:
    npm run test

# Run unit tests in watch mode
[group('testing')]
test-watch:
    npm run test:watch

# Run unit tests with coverage
[group('testing')]
test-coverage:
    npm run test:coverage

# Run E2E tests
[group('testing')]
test-e2e:
    npm run test:e2e

# Run E2E tests in headed mode (with browser UI)
[group('testing')]
test-e2e-headed:
    npm run test:e2e:headed

# Run all tests (unit + coverage + build + E2E)
[group('testing')]
test-all:
    npm run test:all

# Install Playwright browsers
[group('testing')]
test-setup:
    npx playwright install

# ==== Docker ====

# Build development Docker image
[group('docker')]
docker-build-dev:
    docker build -f Dockerfile.dev -t mr-kg-frontend:dev .

# Build production Docker image
[group('docker')]
docker-build-prod:
    docker build -f Dockerfile -t mr-kg-frontend:prod .

# Build all Docker images
[group('docker')]
docker-build: docker-build-dev docker-build-prod

# Run development Docker container
[group('docker')]
docker-run-dev:
    docker run --rm -p 3000:3000 --env-file .env.development -v $(pwd):/app mr-kg-frontend:dev

# Run production Docker container
[group('docker')]
docker-run-prod:
    docker run --rm -p 80:80 --env-file .env.production mr-kg-frontend:prod

# Start development stack with docker-compose
[group('docker')]
docker-dev:
    docker-compose up --build

# Start production stack with docker-compose
[group('docker')]
docker-prod:
    docker-compose -f docker-compose.prod.yml up --build -d

# Stop docker-compose stacks
[group('docker')]
docker-down:
    docker-compose down
    docker-compose -f docker-compose.prod.yml down

# View docker-compose logs
[group('docker')]
docker-logs service="":
    @if [ "{{service}}" = "" ]; then \
        docker-compose logs -f; \
    else \
        docker-compose logs -f {{service}}; \
    fi

# Clean up Docker resources
[group('docker')]
docker-clean:
    docker system prune -f
    docker image prune -f

# Test production build locally
[group('docker')]
test-prod:
    docker build -f Dockerfile -t mr-kg-frontend:test .
    docker run --rm -p 8080:80 mr-kg-frontend:test

# ==== Environment ====

# Create example environment file
[group('environment')]
env-example:
    @echo "Creating .env.example..."
    @echo "VITE_API_BASE_URL=http://localhost:8000" > .env.example
    @echo "VITE_APP_TITLE=MR-KG Explorer" >> .env.example
    @echo "VITE_APP_DESCRIPTION=Mendelian Randomization Knowledge Graph" >> .env.example

# Copy environment example to .env if it doesn't exist
[group('environment')]
env-setup:
    @if [ ! -f .env ]; then cp .env.example .env; echo "Created .env from .env.example"; else echo ".env already exists"; fi